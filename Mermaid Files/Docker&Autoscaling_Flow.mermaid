%%{init: {'theme': 'dark'}}%%
flowchart LR

  %% --- User ---
  subgraph User["User"]
    C["Client / Browser"]
  end

  %% --- Docker Hub ---
  subgraph DockerHub["Docker Hub Registry"]
    DH["(unknownwanderer/cognizantmsjan2026:productapiv1)"]
  end

  %% --- CI Build & Push ---
  subgraph CI["Build & Push"]
    Code["Source Code<br/>(API)"]
    Dockerfile["Dockerfile"]
    Build(["docker build"])
    Tag(["docker tag"])
    Push(["docker push"])
  end

  %% --- Deploy objects ---
  subgraph Deploy["Deployment: productdeploy"]
    direction LR
    Pod1{{"Pod: productapp"}}
    Pod2{{"Pod: productapp"}}
  end

  %% --- EKS cluster ---
  subgraph EKS["Kubernetes Cluster (EKS)"]
    direction TB
    LB["(Service: LoadBalancer<br/>productservice:7074)"]
    Deploy
    MySQL["(Service: ClusterIP<br/>mysql:3306)"]
    DB["(MySQL Pod/StatefulSet)"]
  end

  %% --- Autoscaling ---
  subgraph Scaling["Autoscaling"]
    direction TB
    HPA["HPA: Horizontal Pod Autoscaler<br/>min=1, max=5, cpu=50%"]
    CA["Cluster Autoscaler (EKS Nodes)"]
  end

  %% --- Flow ---
  Code --> Dockerfile
  Dockerfile --> Build
  Build --> Tag
  Tag --> Push
  Push --> DH

  %% LB -> Pods (send traffic to both pods)
  LB --> Pod1
  LB --> Pod2

  %% Pods -> MySQL via env MYSQL_URL (edge labels)
  Pod1 -- "env: MYSQL_URL" --> MySQL
  Pod2 -- "env: MYSQL_URL" --> MySQL

  MySQL --> DB

  %% Image pull from Docker Hub to Pods (dashed)
  DH -. "image pull" .-> Pod1
  DH -. "image pull" .-> Pod2

  %% External user to LB
  C -- "HTTP :7074" --> LB

  %% Autoscaling relations (dashed informative edges)
  HPA -. "scales pods" .-> Deploy
  CA -. "adds/removes nodes" .-> EKS

  %% --- Styles / Classes ---
  classDef k8s fill:#E3F2FD,stroke:#90CAF9,stroke-width:1px,color:#0D47A1
  classDef ext fill:#FFF3E0,stroke:#FFB74D,stroke-width:1px,color:#E65100
  classDef svc fill:#E8F5E9,stroke:#81C784,stroke-width:1px,color:#1B5E20
  classDef ci  fill:#F3E5F5,stroke:#BA68C8,stroke-width:1px,color:#4A148C

  class C ext
  class DH ci
  class Code,Dockerfile,Build,Tag,Push ci
  class Pod1,Pod2,DB k8s
  class LB,MySQL svc
